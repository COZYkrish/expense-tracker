{% extends "base_dashboard.html" %}

{% block content %}
<h1>Analytics Dashboard</h1>
<p class="subtitle">Loan performance overview</p>

<!-- ================= KPI CARDS ================= -->
<div class="kpis">
    <div class="kpi">
        <span>Total Loans</span>
        <h2>{{ total_loans }}</h2>
    </div>
    <div class="kpi">
        <span>Approved</span>
        <h2>{{ approved }}</h2>
    </div>
    <div class="kpi">
        <span>Pending</span>
        <h2>{{ pending }}</h2>
    </div>
    <div class="kpi">
        <span>Rejected</span>
        <h2>{{ rejected }}</h2>
    </div>
    <div class="kpi">
        <span>Total Amount</span>
        <h2>â‚¹{{ total_amount }}</h2>
    </div>
</div>

<!-- ================= CHARTS ================= -->
<div class="charts">
    <div class="chart-card">
        <canvas id="statusChart"></canvas>
    </div>
    <div class="chart-card">
        <canvas id="monthlyChart"></canvas>
    </div>
</div>

<!-- ================= CHART JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
fetch("/admin/analytics/chart-data")
    .then(res => res.json())
    .then(data => {

        new Chart(document.getElementById("statusChart"), {
            type: "pie",
            data: {
                labels: Object.keys(data.status),
                datasets: [{
                    data: Object.values(data.status),
                    backgroundColor: ["#22c55e", "#f97316", "#ef4444"]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: "top" }
                }
            }
        });

        new Chart(document.getElementById("monthlyChart"), {
            type: "bar",
            data: {
                labels: data.monthly.labels,
                datasets: [{
                    label: "Loans per Month",
                    data: data.monthly.values,
                    backgroundColor: "#4f46e5"
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    })
    .catch(err => console.error("Chart error:", err));
</script>
{% endblock %}
